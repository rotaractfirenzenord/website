<!DOCTYPE html>
<html lang="it">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width">

	<title>Bollettino | Rotaract Club Firenze Nord</title>
	<link rel="icon" href="/assets/img/favicon.png" type="image/png">
	<style>
		@import url(/css/fonts.css);

		html {
			--azure: #0067c8;
			--charcoal: #54565a;
			--cranberry: #d41367;
			--royal-blue: #17458f;
			--cardinal: #e02927;
			--whatsapp-green: #25d366;
			--facebook-blue: #3b5998;
			--gold: #f7a81b;

			--nav-height: 8rex;

			scroll-padding-top: var(--nav-height);
			scroll-behavior: smooth;
		}

		body {
			font-family: 'Open Sans', sans-serif;
			color: var(--charcoal);
			background-color: #f8f9fa;
			margin: 0;
			padding: 0;
			line-height: 1.6;
		}

		nav {
			background-color: var(--cranberry);
			padding-inline: 1rem;
			text-align: center;
			display: flex;
			overflow-x: auto;
			gap: 2rem;
			position: sticky;
			top: 0;
			height: var(--nav-height);
			align-items: center;
			box-sizing: border-box;

			@media screen and (min-width: 576px) {
				justify-content: center;
			}

			a {
				color: white;
				text-decoration: none;
				font-weight: bold;
				flex-shrink: 0;
			}
		}

		header {
			background-color: var(--royal-blue);
			color: white;
			text-align: center;
			padding: 2rem 0;

			h1 {
				font-size: 2rem;
				margin: 0;
			}
		}

		section {
			padding-inline: 1rem;
			max-width: 50rem;
			margin-inline: auto;
		}

		#lettera {
			margin-inline: auto;
			margin-top: 2rem;
			padding-block: 1rem;
			background-color: white;
			box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
			border-left: 5px solid var(--cranberry);

			h2 {
				margin-top: 0;
				font-family: 'Georgia', serif;
				color: var(--cranberry);
				text-align: center;
			}

			article {
				font-family: 'Georgia', serif;
				font-size: 1.1rem;
				text-align: justify;
			}
		}

		#eventi h2,
		#direttivo h2,
		#contatti h2 {
			text-align: center;
			color: var(--royal-blue);
			border-bottom: 3px solid var(--cranberry);
			padding-bottom: 0.5rem;
		}

		#eventi {
			&>div>ul {
				list-style-type: none;
				padding: 0;

				&>li {
					background: white;
					margin: 1rem 0;
					padding: 1rem;
					border-radius: 5px;
					box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
				}
			}

			h3 {
				color: var(--azure);
			}

			h4 {
				color: var(--cardinal);
				margin-top: 0;
				margin-bottom: 5px;
			}

			a {
				color: var(--royal-blue);
				font-weight: bold;
			}
		}

		#direttivo {
			ul {
				list-style-type: none;
				padding: 0;
				display: grid;
				grid-template-columns: repeat(auto-fit, minmax(20rem, 1fr));
				gap: 1rem;
			}

			li {
				background: white;
				padding: 1rem;
				text-align: center;
				border-radius: 5px;
				box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
			}

			img {
				display: block;
				width: 8rem;
				height: 8rem;
				border-radius: 50%;
				margin-bottom: 10px;
				margin-inline: auto;
			}

			h3 {
				margin-block: 0.25rem;
				color: var(--cranberry);
			}

			h4 {
				margin-block: 0.25rem;
				color: var(--royal-blue);
			}

			.email {
				display: inline-block;
				max-width: 100%;
				overflow: hidden;
				white-space: nowrap;
				text-overflow: ellipsis;
			}

			a {
				color: var(--azure);
				text-decoration: none;
			}
		}

		#contatti {
			ul {
				list-style-type: none;
				display: flex;
				justify-content: center;
				flex-wrap: wrap;
				padding: 0;
			}

			li {
				margin: 1rem;
				text-align: center;
			}

			a {
				display: block;
				color: var(--royal-blue);
				text-decoration: none;
				font-weight: bold;
				margin-top: 5px;
			}

			[role="img"] {
				width: 3rem;
				height: 3rem;
				display: inline-block;

				svg {
					display: block;
					max-width: 100%;
					max-height: 100%;
					margin-inline: auto;
				}

				&[title="WhatsApp"] {
					path {
						fill: var(--whatsapp-green);
					}
				}

				&[title="Facebook"] {
					path {
						fill: var(--facebook-blue);
					}
				}
			}
		}

		footer {
			text-align: center;
			background: var(--charcoal);
			color: white;
			padding: 1rem;
			margin-top: 2rem;

			a {
				color: var(--gold);
				text-decoration: none;
				font-weight: bold;
			}
		}
	</style>
	<script type="module">
		// @ts-check

		/**
		 * @typedef {Object} CalendarDateTime
		 * @property {string} [dateTime] - RFC3339 timestamp with timezone
		 * @property {string} [date] - Date in YYYY-MM-DD format for all-day events
		 * @property {string} [timeZone] - Timezone identifier
		 */

		/**
		 * @typedef {Object} CalendarEvent
		 * @property {string} id - Event identifier
		 * @property {string} [summary] - Event title
		 * @property {string} [description] - Event description
		 * @property {string} [location] - Event location
		 * @property {CalendarDateTime} [start] - Start date/time
		 * @property {CalendarDateTime} [end] - End date/time
		 * @property {string} [hangoutLink] - Google Meet/Hangout link
		 * @property {string} status - Event status (confirmed, tentative, cancelled)
		 */

		/**
		 * @typedef {Object} CalendarResponse
		 * @property {string} kind - Type of the collection ("calendar#events")
		 * @property {string} etag - ETag of the collection
		 * @property {string} summary - Title of the calendar
		 * @property {string} updated - Last modification time as RFC3339 timestamp
		 * @property {string} timeZone - Timezone of the calendar
		 * @property {string} accessRole - Access role of the user
		 * @property {CalendarEvent[]} items - List of events
		 * @property {string} [nextPageToken] - Token for pagination
		 */

		const API_KEY = 'AIzaSyBPOYU1Itr5OwwjO3FKzfjmdFuffsdlJ3Y';
		const CALENDARS = [
			// Eventi di club, di zona e distrettuali
			"c_fc62a0ef4d047037f61b5e54e71ba151157c481bd5a9cfa02fb96ff5399f8162@group.calendar.google.com",

			// Eventi del Rotary Club Firenze Nord
			"c_f9cd0931d1cb00ebe10cef5184687f418879ced5e9c0570f3fa0a7affba2ac97@group.calendar.google.com",
		]

		const urlParams = new URLSearchParams(window.location.search);
		const year = parseInt(urlParams.get('anno') || new Date().getFullYear().toString());
		const month = parseInt(urlParams.get('mese') || (new Date().getMonth() + 1).toString());

		const MONTH_NAMES = [
			'gennaio',
			'febbraio',
			'marzo',
			'aprile',
			'maggio',
			'giugno',
			'luglio',
			'agosto',
			'settembre',
			'ottobre',
			'novembre',
			'dicembre',
		];

		const header = /** @type {HTMLElement} */ (document.querySelector('header'));
		const monthSpan = /** @type {HTMLSpanElement} */ (header.querySelector('.mese'));
		const yearSpan = /** @type {HTMLSpanElement} */ (header.querySelector('.anno'));
		monthSpan.textContent = MONTH_NAMES[month - 1] || '';
		yearSpan.textContent = year.toString();

		document.title = `Bollettino di ${MONTH_NAMES[month - 1] || ''} ${year} | Rotaract Club Firenze Nord`;

		const SPREADSHEET_ID = '1WBzWn5gFOY3WK3AEfoGrsjYzSLnKKTMdyfDzy3rNPD0';
		const SHEET_NAME = 'Lettere';

		/**
		 * @param {number} year - Anno
		 * @param {number} month - Mese
		 * @returns {Promise<{contenuto: string, firma: string} | null>}
		 */
		async function fetchLetter(year, month) {
			const url = `https://sheets.googleapis.com/v4/spreadsheets/${SPREADSHEET_ID}/values/${SHEET_NAME}?key=${API_KEY}`;
			const response = await fetch(url);
			const data = await response.json();

			if (!data.values) return null;

			const row = data.values.find(row =>
				parseInt(row[0]) === year && parseInt(row[1]) === month
			);

			if (!row) return null;

			return {
				contenuto: row[2] || '',
				firma: row[3] || '',
			};
		}

		/**
		 * @param {string} text
		 * @returns {string}
		 */
		function nl2br(text) {
			if (!text) return '';
			return text.replace(/\r\n|\n\r|\r|\n/g, '<br>');
		}

		/**
		 * @param {{contenuto: string, firma: string} | null} letter
		 */
		function populateLetter(letter) {
			const section = document.querySelector('#lettera');
			if (!section) return;

			const article = /** @type {HTMLElement} */ (section.querySelector('article'));

			if (letter) {
				article.innerHTML = nl2br(letter.contenuto);

				if (letter.firma) {
					const firma = document.createElement('p');
					firma.innerHTML = nl2br(letter.firma);
					firma.style.textAlign = 'right';
					firma.style.fontWeight = 'bold';
					article.appendChild(firma);
				}
			} else {
				const errorMessage = document.createElement('p');
				errorMessage.textContent = 'Questa lettera non è stata ancora scritta 🙂';
				errorMessage.style.textAlign = 'center';
				errorMessage.style.fontStyle = 'italic';
				errorMessage.style.color = 'var(--charcoal)';
				article.replaceChildren(errorMessage);
			}
		}

		/**
		 * @param {string} id 
		 * @returns {Promise<CalendarResponse>}
		 */
		async function fetchCalendar(id) {
			const timeMin = new Date(year, month - 1, 1).toISOString();
			const timeMax = new Date(year, month, 1).toISOString();

			const url = new URL(`https://www.googleapis.com/calendar/v3/calendars/${id}/events`);
			url.searchParams.append('key', API_KEY);
			url.searchParams.append('timeMin', timeMin);
			url.searchParams.append('timeMax', timeMax);
			url.searchParams.append('singleEvents', 'true');
			url.searchParams.append('orderBy', 'startTime');

			const response = await fetch(url);
			return response.json();
		}

		/**
		 * @param {CalendarEvent[]} events 
		 * @param {string} calendarName
		 * @returns {HTMLDivElement | null}
		 */
		function generateEventsHTML(events, calendarName) {
			if (events.length === 0) return null;

			const section = document.createElement('div');

			const title = document.createElement('h3');
			title.textContent = calendarName;
			section.appendChild(title);

			const ul = document.createElement('ul');

			events.forEach(event => {
				const li = document.createElement('li');

				const h4 = document.createElement('h4');
				h4.textContent = event.summary || 'Evento senza titolo';
				li.appendChild(h4);

				if (event.hangoutLink) {
					const italicSpan = document.createElement('span');
					italicSpan.style.fontStyle = 'italic';
					italicSpan.textContent = 'Evento telematico';
					li.appendChild(italicSpan);
					li.appendChild(document.createElement('br'));
				}

				const dateSpan = document.createElement('span');
				const startDateTime = event.start?.dateTime || event.start?.date;
				const isAllDay = !!event.start?.date && !event.start?.dateTime;
				if (startDateTime) {
					dateSpan.innerHTML = `📅 ${getFormattedDate(startDateTime, isAllDay)}`;
					li.appendChild(dateSpan);
				}

				if (event.location) {
					li.appendChild(document.createElement('br'));
					const locationSpan = document.createElement('span');
					const mapsLink = document.createElement('a');
					mapsLink.target = '_blank';
					mapsLink.href = `http://www.google.com/maps/dir/?api=1&destination=${encodeURIComponent(event.location)}`;
					mapsLink.textContent = 'clicca qui';

					locationSpan.innerHTML = `📍 ${event.location} - `;
					locationSpan.appendChild(mapsLink);
					locationSpan.insertAdjacentText('beforeend', ' per avviare il navigatore');
					li.appendChild(locationSpan);
				}

				if (event.description) {
					li.appendChild(document.createElement('br'));
					const descSpan = document.createElement('span');
					descSpan.textContent = event.description;
					li.appendChild(descSpan);
				}

				if (event.hangoutLink) {
					li.appendChild(document.createElement('br'));
					const hangoutSpan = document.createElement('span');
					const hangoutLink = document.createElement('a');
					hangoutLink.href = event.hangoutLink;
					hangoutLink.textContent = event.hangoutLink;
					hangoutSpan.appendChild(hangoutLink);
					li.appendChild(hangoutSpan);
				}

				ul.appendChild(li);
			});

			section.appendChild(ul);
			return section;
		}


		/**
		 * @param {string} dateTimeString 
		 * @param {boolean} isAllDay 
		 */
		function getFormattedDate(dateTimeString, isAllDay) {
			const date = new Date(dateTimeString);
			/** @type {Intl.DateTimeFormatOptions} */
			const options = {
				weekday: 'long',
				year: 'numeric',
				month: 'long',
				day: 'numeric'
			};

			if (!isAllDay) {
				options.hour = '2-digit';
				options.minute = '2-digit';
			}

			return date.toLocaleDateString('it-IT', options);
		}

		/**
		 * @param {CalendarResponse[]} results
		 */
		function handleCalendarLoadSuccess(results) {
			const eventiSection = document.querySelector('#eventi');
			if (!eventiSection) return;

			eventiSection.querySelectorAll('div').forEach(div => div.remove());

			results.forEach((result, index) => {
				if (result.items && result.items.length > 0) {
					const eventsHTML = generateEventsHTML(result.items, result.summary);
					if (eventsHTML) {
						eventiSection.appendChild(eventsHTML);
					}
				}
			});

			if (results.every(result => !result.items || result.items.length === 0)) {
				const noEventsMessage = document.createElement('p');
				noEventsMessage.textContent = 'Nessun evento programmato per questo mese.';
				noEventsMessage.style.textAlign = 'center';
				noEventsMessage.style.fontStyle = 'italic';
				noEventsMessage.style.color = 'var(--charcoal)';
				eventiSection.appendChild(noEventsMessage);
			}
		}

		/**
		 * @param {Error} error
		 */
		function handleCalendarLoadError(error) {
			const eventiSection = document.querySelector('#eventi');
			if (eventiSection) {
				const errorMessage = document.createElement('p');
				errorMessage.textContent = 'Errore nel caricamento degli eventi. Riprova più tardi.';
				errorMessage.style.textAlign = 'center';
				errorMessage.style.fontStyle = 'italic';
				errorMessage.style.color = 'var(--cardinal)';
				eventiSection.appendChild(errorMessage);
			}
		}

		fetchLetter(year, month)
			.then(populateLetter)
			.catch(error => {
				console.error('Errore nel caricamento della lettera:', error);
			});

		Promise.all(CALENDARS.map(fetchCalendar))
			.then(handleCalendarLoadSuccess)
			.catch(handleCalendarLoadError);
	</script>
</head>

<body>
	<nav>
		<a href="#lettera">Lettera del Presidente</a>
		<a href="#eventi">Eventi</a>
		<a href="#direttivo">Consiglio direttivo</a>
		<a href="#contatti">Contatti</a>
	</nav>

	<header>
		<h1>Bollettino di <span class="mese"></span> <span class="anno"></span></h1>
	</header>

	<main>
		<section id="lettera">
			<h2>Lettera del Presidente</h2>
			<article>
				<div id="loading-spinner" style="display: flex; justify-content: center; align-items: center; padding: 2rem;">
					<div style="
						width: 40px;
						height: 40px;
						border: 4px solid #f3f3f3;
						border-top: 4px solid var(--cranberry);
						border-radius: 50%;
						animation: spin 1s linear infinite;
					"></div>
				</div>

				<style>
					@keyframes spin {
						from {
							transform: rotate(0turn);
						}

						to {
							transform: rotate(1turn);
						}
					}
				</style>

				<p style="text-align: center; font-style: italic; color: var(--charcoal);">
					Caricamento della lettera in corso...
				</p>
			</article>
		</section>

		<section id="eventi">
			<h2>Eventi del mese</h2>
		</section>

		<section id="direttivo">
			<h2>Il consiglio direttivo 2025/2026</h2>
			<ul>
				<li>
					<img src="/assets/img/team/costanza.jpg" alt="Costanza Panzani, Presidente, A.R. 2025/2026">
					<h3>Costanza Panzani</h3>
					<h4>Presidente</h4>
					<a class="email" href="mailto:costanza.panzani@rotaractfirenzenord.org" target="_blank">costanza.panzani@rotaractfirenzenord.org</a>
				</li>
				<li>
					<img src="/assets/img/team/irene.jpg" alt="Irene Graziani, Vicepresidente, A.R. 2025/2026">
					<h3>Irene Graziani</h3>
					<h4>Vicepresidente</h4>
					<a class="email" href="mailto:irene.graziani@rotaractfirenzenord.org" target="_blank">irene.graziani@rotaractfirenzenord.org</a>
				</li>
				<li>
					<img src="/assets/img/team/annalisa.jpg" alt="Annalisa Velasco Ramirez, Segretario, A.R. 2025/2026">
					<h3>Annalisa Velasco Ramirez</h3>
					<h4>Segretario</h4>
					<a class="email" href="mailto:annalisa.velascoramirez@rotaractfirenzenord.org" target="_blank">annalisa.velascoramirez@rotaractfirenzenord.org</a>
				</li>
				<li>
					<img src="/assets/img/team/daniele.jpg" alt="Daniele Ambrosino, Segretario, A.R. 2025/2026">
					<h3>Daniele Ambrosino</h3>
					<h4>Segretario</h4>
					<a class="email" href="mailto:daniele.ambrosino@rotaractfirenzenord.org" target="_blank">daniele.ambrosino@rotaractfirenzenord.org</a>
				</li>
				<li>
					<img src="/assets/img/team/carmine.jpg" alt="Carmine Schiavottiello, Tesoriere, A.R. 2025/2026">
					<h3>Carmine Schiavottiello</h3>
					<h4>Tesoriere</h4>
					<a class="email" href="mailto:carmine.schiavottiello@rotaractfirenzenord.org" target="_blank">carmine.schiavottiello@rotaractfirenzenord.org</a>
				</li>
				<li>
					<img src="/assets/img/team/giacomo.webp" alt="Giacomo Aiazzi, Prefetto, A.R. 2025/2026">
					<h3>Giacomo Aiazzi</h3>
					<h4>Prefetto</h4>
					<a class="email" href="mailto:giacomo.aiazzi@rotaractfirenzenord.org" target="_blank">giacomo.aiazzi@rotaractfirenzenord.org</a>
				</li>
				<li>
					<img src="/assets/img/team/pietro.jpg" alt="Pietro Longinetti, Consigliere, A.R. 2025/2026">
					<h3>Pietro Longinetti</h3>
					<h4>Consigliere</h4>
					<a class="email" href="mailto:pietro.longinetti@rotaractfirenzenord.org" target="_blank">pietro.longinetti@rotaractfirenzenord.org</a>
				</li>
				<li>
					<img src="/assets/img/team/malvina.jpg" alt="Malvina Rosseti, Consigliere, A.R. 2025/2026">
					<h3>Malvina Rosseti</h3>
					<h4>Consigliere</h4>
					<a class="email" href="mailto:malvina.rosseti@rotaractfirenzenord.org" target="_blank">malvina.rosseti@rotaractfirenzenord.org</a>
				</li>
			</ul>
		</section>
		<section id="contatti">
			<h2>Contatti</h2>
			<ul>
				<li>
					<span role="img" title="Facebook">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							<path d="M512 256C512 114.6 397.4 0 256 0S0 114.6 0 256C0 376 82.7 476.8 194.2 504.5V334.2H141.4V256h52.8V222.3c0-87.1 39.4-127.5 125-127.5c16.2 0 44.2 3.2 55.7 6.4V172c-6-.6-16.5-1-29.6-1c-42 0-58.2 15.9-58.2 57.2V256h83.6l-14.4 78.2H287V510.1C413.8 494.8 512 386.9 512 256h0z" />
						</svg>
					</span>
					<a href="https://www.facebook.com/rotaractfirenzenord/" target="_blank">@rotaractfirenzenord</a>
				</li>
				<li>
					<span role="img" title="Instagram">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512">
							<path d="M224.1 141c-63.6 0-114.9 51.3-114.9 114.9s51.3 114.9 114.9 114.9S339 319.5 339 255.9 287.7 141 224.1 141zm0 189.6c-41.1 0-74.7-33.5-74.7-74.7s33.5-74.7 74.7-74.7 74.7 33.5 74.7 74.7-33.6 74.7-74.7 74.7zm146.4-194.3c0 14.9-12 26.8-26.8 26.8-14.9 0-26.8-12-26.8-26.8s12-26.8 26.8-26.8 26.8 12 26.8 26.8zm76.1 27.2c-1.7-35.9-9.9-67.7-36.2-93.9-26.2-26.2-58-34.4-93.9-36.2-37-2.1-147.9-2.1-184.9 0-35.8 1.7-67.6 9.9-93.9 36.1s-34.4 58-36.2 93.9c-2.1 37-2.1 147.9 0 184.9 1.7 35.9 9.9 67.7 36.2 93.9s58 34.4 93.9 36.2c37 2.1 147.9 2.1 184.9 0 35.9-1.7 67.7-9.9 93.9-36.2 26.2-26.2 34.4-58 36.2-93.9 2.1-37 2.1-147.8 0-184.8zM398.8 388c-7.8 19.6-22.9 34.7-42.6 42.6-29.5 11.7-99.5 9-132.1 9s-102.7 2.6-132.1-9c-19.6-7.8-34.7-22.9-42.6-42.6-11.7-29.5-9-99.5-9-132.1s-2.6-102.7 9-132.1c7.8-19.6 22.9-34.7 42.6-42.6 29.5-11.7 99.5-9 132.1-9s102.7-2.6 132.1 9c19.6 7.8 34.7 22.9 42.6 42.6 11.7 29.5 9 99.5 9 132.1s2.7 102.7-9 132.1z" />
						</svg>
					</span>
					<a href="https://www.instagram.com/rotaractfirenzenord/" target="_blank">@rotaractfirenzenord</a>
				</li>
				<li>
					<span role="img" title="Email">
						<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
							<path d="M64 112c-8.8 0-16 7.2-16 16l0 22.1L220.5 291.7c20.7 17 50.4 17 71.1 0L464 150.1l0-22.1c0-8.8-7.2-16-16-16L64 112zM48 212.2L48 384c0 8.8 7.2 16 16 16l384 0c8.8 0 16-7.2 16-16l0-171.8L322 328.8c-38.4 31.5-93.7 31.5-132 0L48 212.2zM0 128C0 92.7 28.7 64 64 64l384 0c35.3 0 64 28.7 64 64l0 256c0 35.3-28.7 64-64 64L64 448c-35.3 0-64-28.7-64-64L0 128z" />
						</svg>
					</span>
					<a href="mailto:segreteria@rotaractfirenzenord.org">segreteria@rotaractfirenzenord.org</a>
				</li>
			</ul>
		</section>
	</main>

	<footer>
		<p>
			Developed with &hearts; by <a href="https://danieleambrosino.it" target="_blank"><b>Daniele Ambrosino</b></a> - © Rotaract Club Firenze Nord
		</p>
	</footer>
</body>

</html>